<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StreamDrop Premium</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Plyr CSS -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        :root {
            /* Night Mode (Default) */
            --bg-color: #000000;
            --surface-color: #111111;
            --primary-color: #ff0000;
            --primary-glow: rgba(255, 0, 0, 0.4);
            --text-main: #ffffff;
            --text-sec: #aaaaaa;
            --border-color: #333333;
            --glass-bg: rgba(20, 20, 20, 0.7);
        }

        [data-theme="day"] {
            /* Day Mode (Cream) */
            --bg-color: #fcfbf7;
            /* Creamy White */
            --surface-color: #ffffff;
            --primary-color: #d97706;
            /* Amber/Gold */
            --primary-glow: rgba(217, 119, 6, 0.3);
            --text-main: #1f2937;
            --text-sec: #6b7280;
            --border-color: #e5e7eb;
            --glass-bg: rgba(255, 255, 255, 0.8);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            transition: background-color 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Abstract Background blobs */
        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            z-index: -1;
            opacity: 0.4;
            transition: background 0.5s ease;
        }

        .blob-1 {
            top: -10%;
            left: -10%;
            width: 500px;
            height: 500px;
            background: var(--primary-glow);
            animation: float 10s infinite alternate;
        }

        .blob-2 {
            bottom: -10%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: #222;
            animation: float 12s infinite alternate-reverse;
        }

        @keyframes float {
            0% {
                transform: translate(0, 0);
            }

            100% {
                transform: translate(30px, 30px);
            }
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Plyr Overrides */
        .plyr {
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            --plyr-color-main: var(--primary-color);
            --plyr-video-background: var(--surface-color);
            --plyr-menu-background: var(--surface-color);
            --plyr-menu-color: var(--text-main);
        }

        /* Loaders */
        .loader-dots {
            display: inline-flex;
            gap: 4px;
        }

        .loader-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary-color);
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loader-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loader-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* Button Hover Effects */
        .btn-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-hover:active {
            transform: scale(0.96);
        }

        /* Selection */
        ::selection {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen items-center justify-center p-4">

    <!-- Background Blobs -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>

    <!-- Theme Toggle (Floating) -->
    <button onclick="toggleTheme()"
        class="fixed top-6 right-6 z-50 p-3 rounded-full glass-card hover:brightness-110 transition-all shadow-lg active:scale-90 group">
        <i class="ri-moon-line text-xl group-[.day]:hidden"></i>
        <i class="ri-sun-line text-xl hidden group-[.day]:block text-yellow-500"></i>
    </button>

    <!-- Main Card -->
    <div class="glass-card rounded-[32px] w-full max-w-[1000px] overflow-hidden opacity-0 translate-y-8 transition-all duration-700 ease-out"
        id="main-content">

        <!-- Navbar -->
        <div class="border-b border-[var(--border-color)] p-6 md:p-8 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div
                    class="w-12 h-12 rounded-2xl bg-[var(--primary-color)] flex items-center justify-center text-white text-2xl shadow-lg shadow-[var(--primary-glow)]">
                    <i class="ri-play-fill"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">StreamDrop</h1>
                    <div class="flex items-center gap-2 text-xs font-medium text-[var(--text-sec)]">
                        <span class="px-2 py-0.5 rounded-full border border-[var(--border-color)]">SECURE</span>
                        <span class="px-2 py-0.5 rounded-full border border-[var(--border-color)]">ENCRYPTED</span>
                    </div>
                </div>
            </div>
            <!-- Size Badge -->
            <div id="size-badge" class="hidden md:flex flex-col items-end">
                <span class="text-xs text-[var(--text-sec)] uppercase tracking-wider font-semibold">File Size</span>
                <span class="text-lg font-bold" id="size-text">...</span>
            </div>
        </div>

        <!-- Media Area -->
        <div class="p-6 md:p-10">

            <!-- Loading State -->
            <div id="loader-state" class="flex flex-col items-center justify-center py-20 space-y-6">
                <div class="loader-dots scale-150"><span></span><span></span><span></span></div>
                <p class="text-sm font-medium tracking-widest uppercase text-[var(--text-sec)] animate-pulse">Retrieving
                    Metadata...</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="hidden flex-col items-center justify-center py-24 text-center">
                <div class="relative w-24 h-24 mb-6 group">
                    <div class="absolute inset-0 bg-red-500/20 blur-xl rounded-full animate-pulse"></div>
                    <div
                        class="relative w-full h-full rounded-2xl bg-[var(--surface-color)] border border-red-500/30 flex items-center justify-center text-red-500 shadow-xl">
                        <i class="ri-forbid-2-line text-5xl"></i>
                    </div>
                </div>

                <h2 class="text-3xl font-bold mb-3 tracking-tight">Access Denied</h2>
                <p class="text-[var(--text-sec)] max-w-sm mx-auto mb-8 leading-relaxed">
                    This link has **Expired** or is invalid. <br>
                    Please request a new link from the bot.
                </p>

                <a href="https://t.me/STREAM_DROP_BOT"
                    class="btn-hover bg-[var(--surface-color)] border border-[var(--border-color)] px-8 py-3 rounded-xl font-bold text-[var(--text-main)] hover:border-[var(--primary-color)] hover:text-[var(--primary-color)] transition-all shadow-lg inline-flex items-center gap-2">
                    <i class="ri-telegram-fill text-xl"></i> Open Telegram Bot
                </a>
            </div>

            <!-- Content State -->
            <div id="success-state" class="hidden">

                <!-- Player Wrapper -->
                <div id="player-container"
                    class="relative group w-full bg-black rounded-2xl overflow-hidden shadow-2xl mb-8 aspect-video hidden">
                    <!-- Overlay Loader for Buffer -->
                    <div id="media-loader"
                        class="absolute inset-0 z-20 flex items-center justify-center bg-black/60 pointer-events-none opacity-0 transition-opacity duration-300">
                        <div class="loader-dots"><span></span><span></span><span></span></div>
                    </div>
                </div>

                <!-- PDF/Image Viewer Area -->
                <div id="viewer-container"
                    class="hidden w-full bg-[var(--surface-color)] rounded-2xl border border-[var(--border-color)] p-4 h-[600px] mb-8 overflow-hidden relative">
                    <iframe id="pdf-frame" class="w-full h-full rounded-lg hidden"></iframe>
                    <img id="image-view" class="w-full h-full object-contain rounded-lg hidden" />
                </div>

                <!-- Info Header -->
                <div class="flex flex-col md:flex-row md:items-start justify-between gap-6 mb-8">
                    <div class="flex-1">
                        <h2 id="fname-text" class="text-2xl md:text-3xl font-bold leading-tight mb-3 break-all"></h2>
                        <div class="flex flex-wrap gap-2">
                            <span id="type-badge"
                                class="px-3 py-1 rounded-lg text-xs font-bold uppercase bg-[var(--surface-color)] border border-[var(--border-color)]">UNKNOWN</span>
                            <span
                                class="px-3 py-1 rounded-lg text-xs font-bold uppercase bg-green-500/10 text-green-500 border border-green-500/20">READY</span>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="flex gap-2">
                        <button onclick="copyLink()"
                            class="btn-hover w-10 h-10 rounded-xl bg-[var(--surface-color)] border border-[var(--border-color)] flex items-center justify-center text-[var(--text-sec)] hover:text-[var(--text-main)] hover:border-[var(--primary-color)] relative group">
                            <i class="ri-file-copy-line text-lg"></i>
                            <span
                                class="absolute -top-10 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap">Copy
                                Link</span>
                        </button>
                        <button onclick="shareLink()"
                            class="btn-hover w-10 h-10 rounded-xl bg-[var(--surface-color)] border border-[var(--border-color)] flex items-center justify-center text-[var(--text-sec)] hover:text-[var(--text-main)] hover:border-[var(--primary-color)]">
                            <i class="ri-share-forward-line text-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Primary Action Buttons -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="action-buttons">
                    <!-- Injected by JS -->
                </div>

            </div>

        </div>

        <!-- Footer -->
        <div class="bg-[var(--surface-color)] p-4 text-center border-t border-[var(--border-color)]">
            <p class="text-xs font-semibold text-[var(--text-sec)] tracking-wider">
                POWERED BY <span class="text-[var(--primary-color)]">UNIVORA</span> &bull; DEV <span
                    class="text-[var(--text-main)]">ROLEX SIR</span>
            </p>
        </div>

    </div>

    <!-- Scripts -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        const BASE_URL = window.location.origin;
        const FILE_ID = window.location.pathname.split("/").pop();

        // Theme Logic
        function toggleTheme() {
            const body = document.body;
            const btn = document.querySelector('button[onclick="toggleTheme()"]');

            if (body.getAttribute('data-theme') === 'day') {
                body.removeAttribute('data-theme');
                btn.classList.remove('day');
                localStorage.setItem('theme', 'night');
            } else {
                body.setAttribute('data-theme', 'day');
                btn.classList.add('day');
                localStorage.setItem('theme', 'day');
            }
        }

        // Init Theme
        if (localStorage.getItem('theme') === 'day') {
            document.body.setAttribute('data-theme', 'day');
            document.querySelector('button[onclick="toggleTheme()"]').classList.add('day');
        }

        // Animation Init
        window.onload = () => {
            requestAnimationFrame(() => {
                document.getElementById('main-content').classList.remove('opacity-0', 'translate-y-8');
            });
        };

        // Clipboard
        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                const icon = document.querySelector('.ri-file-copy-line');
                icon.className = 'ri-check-line text-green-500';
                setTimeout(() => icon.className = 'ri-file-copy-line', 2000);
            });
        }

        // Share
        function shareLink() {
            if (navigator.share) {
                navigator.share({
                    title: document.title,
                    url: window.location.href
                });
            } else {
                copyLink();
            }
        }

        async function init() {
            try {
                const res = await fetch(`${BASE_URL}/api/file/${FILE_ID}`);
                if (!res.ok) throw new Error("API Error");
                const data = await res.json();

                // Populate Info
                document.title = data.file_name;
                document.getElementById('fname-text').innerText = data.file_name;
                document.getElementById('size-text').innerText = data.file_size;

                const typeBadge = document.getElementById('type-badge');
                const playerContainer = document.getElementById('player-container');
                const viewerContainer = document.getElementById('viewer-container');
                const buttons = document.getElementById('action-buttons');
                const mediaLoader = document.getElementById('media-loader');

                // --- MEDIA TYPE LOGIC ---
                let primaryBtnIcon = "ri-download-cloud-2-fill";
                let primaryBtnText = "Download File";

                // 1. Audio (Music Player)
                if (data.is_media && data.file_name.match(/\.(mp3|aac|wav|flac|m4a|ogg)$/i)) {
                    playerContainer.classList.remove('hidden');
                    // Remove aspect-video for audio to avoid big black box
                    playerContainer.classList.remove('aspect-video', 'bg-black');
                    playerContainer.classList.add('bg-[var(--surface-color)]', 'p-6');

                    typeBadge.innerText = "AUDIO TRACK";

                    // Audio UI Structure
                    playerContainer.innerHTML = `
                         <div class="flex flex-col gap-6">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-[var(--primary-color)] to-purple-600 flex items-center justify-center shadow-lg shadow-[var(--primary-glow)]">
                                    <i class="ri-music-2-fill text-3xl text-white"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-lg font-bold truncate">${data.file_name}</h3>
                                    <p class="text-xs text-[var(--text-sec)]">High Quality Audio</p>
                                </div>
                            </div>
                            <audio id="audio-player" class="w-full" controls crossorigin playsinline>
                                <source src="${data.direct_dl_link}" type="audio/mp4"> 
                            </audio>
                         </div>
                    `;

                    const audioEl = document.getElementById('audio-player');

                    // Initialize Plyr for Audio
                    const player = new Plyr(audioEl, {
                        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings'],
                        autoplay: true
                    });

                    primaryBtnText = "Download Music";

                    // Buttons
                    buttons.innerHTML += `
                        <a href="${data.direct_dl_link}" download class="btn-hover bg-[var(--primary-color)] rounded-xl py-4 flex items-center justify-center gap-3 text-white font-bold shadow-lg shadow-[var(--primary-glow)] hover:brightness-110">
                            <i class="${primaryBtnIcon} text-xl"></i> ${primaryBtnText}
                        </a>
                    `;
                }

                // 2. Video (Video Player)
                else if (data.is_media) {
                    playerContainer.classList.remove('hidden');
                    // REMOVE aspect-video to let Plyr calculate exact height (Fixes Black Gap)
                    playerContainer.classList.remove('aspect-video');
                    playerContainer.classList.add('bg-black');

                    typeBadge.innerText = "VIDEO STREAM";

                    const videoEl = document.createElement('video');
                    videoEl.src = data.direct_dl_link;
                    videoEl.controls = true;
                    videoEl.playsInline = true;
                    videoEl.crossOrigin = "anonymous";
                    videoEl.style.width = '100%';
                    videoEl.style.height = '100%';

                    // Re-add loader structure
                    playerContainer.innerHTML = '';

                    // Create Loader Element (Visible by default, Z-Index 50 to stay on top of Plyr)
                    const loaderDiv = document.createElement('div');
                    loaderDiv.id = 'media-loader';
                    loaderDiv.className = 'absolute inset-0 z-50 flex items-center justify-center bg-black/90 transition-opacity duration-300 pointer-events-none';
                    loaderDiv.innerHTML = `
                        <div class="flex flex-col items-center gap-4">
                            <div class="loader-dots scale-150"><span></span><span></span><span></span></div>
                            <p class="text-xs font-semibold text-gray-400 tracking-widest uppercase animate-pulse">Loading Stream</p>
                        </div>
                    `;

                    playerContainer.appendChild(loaderDiv);
                    playerContainer.appendChild(videoEl);

                    // Initialize Plyr
                    const player = new Plyr(videoEl, {
                        controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
                        autoplay: true,
                        hideControls: false,
                        keyboard: { focused: true, global: true },
                        ratio: '16:9', // Default ratio to prevent CLS, will adapt
                        resetOnEnd: true
                    });

                    // Smart Loader Logic
                    // Force Loader Visible Initially
                    loaderDiv.style.opacity = '1';

                    function hideLoader() {
                        loaderDiv.style.opacity = '0';
                        // Delay hiding display to allow fade out
                        setTimeout(() => loaderDiv.style.display = 'none', 500);
                    }

                    function showLoader() {
                        loaderDiv.style.display = 'flex';
                        void loaderDiv.offsetWidth; // Trigger reflow
                        loaderDiv.style.opacity = '1';
                    }

                    // Events
                    player.on('canplay', hideLoader);
                    player.on('playing', hideLoader);
                    player.on('seeking', showLoader);
                    player.on('seeked', hideLoader);
                    player.on('waiting', showLoader);

                    // Fallback to hide loader if it plays anyway
                    videoEl.addEventListener('playing', hideLoader);

                    primaryBtnText = "Download Video";

                    // Device detection for player routing
                    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
                    let vlcLink = isMobile ? data.vlc_player_link_mobile : data.vlc_player_link_pc;
                    let mxLink = data.mx_player_link;
                    let playitLink = data.playit_link;

                    // Download Button (Full Width)
                    buttons.innerHTML += `
                        <a href="${data.direct_dl_link}" download class="col-span-1 md:col-span-2 btn-hover bg-[var(--primary-color)] rounded-xl py-4 flex items-center justify-center gap-3 text-white font-bold shadow-lg shadow-[var(--primary-glow)] hover:brightness-110">
                            <i class="${primaryBtnIcon} text-xl"></i> ${primaryBtnText}
                        </a>
                    `;

                    // App-specific Buttons Box
                    // Wrap in a div that spans full width but displays grid
                    const appsGrid = document.createElement("div");
                    appsGrid.className = "col-span-1 md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-3 mt-2";

                    // 1. VLC Button
                    if (isMobile) {
                        appsGrid.innerHTML += `
                            <a href="${vlcLink}" class="btn-hover bg-[var(--surface-color)] border border-orange-500/30 rounded-xl py-3 flex items-center justify-center gap-2 font-bold text-orange-500 hover:bg-orange-500 hover:text-white transition-colors shadow-sm">
                                <i class="ri-play-circle-fill text-xl"></i> Open in VLC
                            </a>
                        `;
                    } else {
                        appsGrid.innerHTML += `
                            <button onclick="copyVlcUrl('${data.direct_dl_link}')" class="btn-hover bg-[var(--surface-color)] border border-orange-500/30 rounded-xl py-3 flex items-center justify-center gap-2 font-bold text-orange-500 hover:bg-orange-500 hover:text-white transition-colors shadow-sm">
                                <i class="ri-play-circle-fill text-xl"></i> Stream in VLC
                            </button>
                        `;
                    }

                    // 2. PlayIt & MX Player (Device Specific)
                    if (isMobile) {
                        appsGrid.innerHTML += `
                            <a href="${mxLink}" class="btn-hover bg-[var(--surface-color)] border border-blue-500/30 rounded-xl py-3 flex items-center justify-center gap-2 font-bold text-blue-500 hover:bg-blue-500 hover:text-white transition-colors shadow-sm">
                                <i class="ri-play-circle-fill text-xl"></i> MX Player
                            </a>
                            <a href="${playitLink}" class="btn-hover bg-[var(--surface-color)] border border-green-500/30 rounded-xl py-3 flex items-center justify-center gap-2 font-bold text-green-500 hover:bg-green-500 hover:text-white transition-colors shadow-sm">
                                <i class="ri-play-circle-fill text-xl"></i> PlayIt
                            </a>
                        `;
                    } else {
                        // Laptop PC users see disabled buttons with alert
                        appsGrid.innerHTML += `
                            <button onclick="alert('⚠️ MX Player is an Android/iOS App.\\n\\nFor laptops, please use VLC Player or watch in the browser directly.')" class="btn-hover bg-[var(--surface-color)] border border-[var(--border-color)] rounded-xl py-3 flex items-center justify-center gap-2 font-bold text-[var(--text-sec)] opacity-60 hover:opacity-100 transition-colors">
                                <i class="ri-information-line text-xl"></i> MX Player
                            </button>
                            <button onclick="alert('⚠️ PlayIt is an Android/iOS App.\\n\\nFor laptops, please use VLC Player or watch in the browser directly.')" class="btn-hover bg-[var(--surface-color)] border border-[var(--border-color)] rounded-xl py-3 flex items-center justify-center gap-2 font-bold text-[var(--text-sec)] opacity-60 hover:opacity-100 transition-colors">
                                <i class="ri-information-line text-xl"></i> PlayIt
                            </button>
                        `;
                    }

                    buttons.appendChild(appsGrid);

                }
                // 3. PDF
                else if (data.file_name.match(/\.pdf$/i)) {
                    // ... (rest of PDF logic same as before)
                    viewerContainer.classList.remove('hidden');
                    const iframe = document.getElementById('pdf-frame');
                    iframe.src = data.direct_dl_link;
                    iframe.classList.remove('hidden');
                    typeBadge.innerText = "PDF DOCUMENT";

                    buttons.innerHTML = `
                         <a href="${data.direct_dl_link}" download class="col-span-1 md:col-span-2 btn-hover bg-[var(--primary-color)] rounded-xl py-4 flex items-center justify-center gap-3 text-white font-bold shadow-lg shadow-[var(--primary-glow)] hover:brightness-110">
                            <i class="ri-book-open-line text-xl"></i> Download PDF
                        </a>
                    `;
                }
                // 4. Image
                else if (data.file_name.match(/\.(jpg|jpeg|png|gif|webp)$/i)) {
                    // ... (rest of Image logic same as before)
                    viewerContainer.classList.remove('hidden');
                    viewerContainer.style.height = 'auto'; // Auto height for images
                    const img = document.getElementById('image-view');
                    img.src = data.direct_dl_link;
                    img.classList.remove('hidden');
                    typeBadge.innerText = "IMAGE";

                    buttons.innerHTML = `
                         <a href="${data.direct_dl_link}" download class="col-span-1 md:col-span-2 btn-hover bg-[var(--primary-color)] rounded-xl py-4 flex items-center justify-center gap-3 text-white font-bold shadow-lg shadow-[var(--primary-glow)] hover:brightness-110">
                            <i class="ri-image-line text-xl"></i> Download Image
                        </a>
                    `;
                }
                // 5. Other
                else {
                    typeBadge.innerText = "FILE";
                    buttons.innerHTML = `
                         <a href="${data.direct_dl_link}" download class="col-span-1 md:col-span-2 btn-hover bg-[var(--primary-color)] rounded-xl py-4 flex items-center justify-center gap-3 text-white font-bold shadow-lg shadow-[var(--primary-glow)] hover:brightness-110">
                            <i class="ri-download-2-line text-xl"></i> Fast Download
                        </a>
                    `;
                }

                // Show Content
                document.getElementById('loader-state').classList.add('hidden');
                document.getElementById('success-state').classList.remove('hidden');

                // Admin Embed Section
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('admin') === 'true' && data.embed_link) {
                    const embedContainer = document.createElement("div");
                    embedContainer.className = "mt-8 p-4 rounded-xl bg-[var(--surface-color)] border border-red-500/30";
                    embedContainer.innerHTML = `
                        <h3 class="text-xs font-bold text-red-500 uppercase tracking-widest mb-3"><i class="ri-code-s-slash-line text-lg align-middle mr-1"></i> Developer Embed Code</h3>
                        <div class="relative group">
                            <textarea readonly class="w-full h-20 bg-black border border-[var(--border-color)] rounded-lg p-3 text-xs text-white font-mono resize-none focus:outline-none focus:border-red-500 transition-colors">&lt;iframe src="${data.embed_link}" width="100%" height="100%" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;</textarea>
                            <button onclick="navigator.clipboard.writeText('<iframe src=\\'${data.embed_link}\\' width=\\'100%\\' height=\\'100%\\' frameborder=\\'0\\' allowfullscreen></iframe>'); this.innerHTML = '<i class=\\'ri-check-line\\'></i> Copied!';" class="absolute top-2 right-2 px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-md opacity-0 group-hover:opacity-100 transition-all shadow-lg">
                                <i class="ri-clipboard-line"></i> Copy
                            </button>
                        </div>
                    `;
                    document.getElementById('success-state').appendChild(embedContainer);
                }

            } catch (e) {
                console.error(e);
                document.getElementById('loader-state').classList.add('hidden');
                document.getElementById('error-state').classList.remove('hidden');
            }
        }

        function copyVlcUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert("✅ Stream Link Copied!\n\nTo view in VLC on PC:\n1. Open VLC Media Player\n2. Go to Media > Open Network Stream (Ctrl+N)\n3. Paste the copied link and click Play!");
            }).catch(() => {
                alert("Failed to copy link. Please manually copy the URL from Download Video button.");
            });
        }

        init();
    </script>
</body>

</html>